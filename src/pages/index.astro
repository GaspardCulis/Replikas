---
import Layout from '../layouts/Layout.astro';
import Article from '../components/Article.astro';
import { default as ArticleModel } from '../model/Article';

const mostBids = await ArticleModel.mostBids({ limit: 8, offset: 0 });
// const;
---

<Layout title="Replikas">
	<main>
		<div class="container">
			<div class="carrousel">
				<div class="slider">
					<article></article>
					<article></article>
					<article></article>
					<article></article>
					<article></article>
				</div>
				<div class="controls">
					<span class="arrow prev">Prev</span>
					<span class="arrow next">Next</span>
				</div>
			</div>
		</div>
		<div>
			<h1>Les plus attendus</h1>
			<ul>
				{mostBids.map((article) => <Article article={article} />)}
			</ul>
		</div>
	</main>
</Layout>

<style>
	main {
		margin: 2rem 0;

		display: flex;
		flex-direction: column;
		align-items: center;
	}

	div {
		background-color: var(--theme-secondary);
		width: 85%;
		margin: 0;
		padding: 20px;
		border-radius: 20px;
	}

	h1 {
		font-size: 3rem;
		font-weight: 800;
		margin: 50px;
		text-align: center;
	}

	ul {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		padding: 0;
	}

	.container {
		width: 90%;
		margin: 20px auto;
		height: 300px;
	}

	.carrousel {
		width: 100%;
		height: 100%;
		border: 2px solid green;
		border-radius: 3px;
		display: flex;
		justify-content: flex-start;
		position: relative;
	}

	.slider {
		border: 1px solid blue;
		display: flex;
		height: 100%;
		width: 500%;
		flex-shrink: 0;
	}
	.slider article {
		border: 1px solid red;
		flex-basis: 20%;
		width: 20%;
		flex-shrink: 0;
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.arrow {
		position: absolute;
		top: 10px;
	}

	.arrow.prev {
		left: 10px;
	}

	.arrow.next {
		right: 10px;
	}
</style>

<script>
	const slider: any = document.querySelector('.slider');
	const carrousel: any = document.querySelector('.carrousel');
	const prev: any = document.querySelector('.prev');
	const next: any = document.querySelector('.next');

	var direction: number;

	prev.addEventListener('click', function () {
		direction = 1;
		carrousel.style.justifyContent = 'flex-end';
		slider.style.transform = 'translate(20%)';
	});

	next.addEventListener('click', function () {
		direction = -1;
		carrousel.style.justifyContent = 'flex-start';
		slider.style.transform = 'translate(-20%)';
	});

	slider.addEventListener('transitionend', function () {
		if (direction === 1) {
			slider.prepend(slider.lastElementChild);
		} else if (direction === -1) {
			slider.appendChild(slider.firstElementChild);
		}

		slider.style.transition = 'none';
		slider.style.transform = 'translate(0)';
		setTimeout(function () {
			slider.style.transition = 'all 0.5s';
		});
	});
</script>
